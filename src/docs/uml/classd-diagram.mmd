classDiagram
%% Abstract Classes and Interfaces
    class BusinessPerson {
        <<abstract>>
        -Long id
        -String name
        -String email
        -String password
        -Company company
        -PersonStatus status
        -LocalDateTime createdAt
        -LocalDateTime upatedAt
        +getId()
        +setId()
        +getName()
        +setName()
        +getEmail()
        +setEmail()
        +getPassword()
        +setPassword()
        +getCompany()
        +setCompany()
        +getStatus()
        +setStatus()
        +getCreatedAt()
        +getUpdatedAt()
        +onUpdate()
    }

    class BusinessPersonDTO {
        <<abstract>>
        -Long id
        -String name
        -String email
        -Long businessId
        -String businessName
        -PersonStatus status
        -LocalDateTime createdAt
        -LocalDateTime updatedAt
        +getId()
        +getName()
        +getEmail()
        +getBusinessId()
        +getBusinessName()
        +getStatus()
        +getCreatedAt()
        +getUpdatedAt()
        +Builder
    }

    class Business {
        <<interface>>
        +getName()
        +addEmployee()
        +removeEmployee()
        +getEmployees()
    }

%% Domain Models

    class Employee {
        -double salary
        -Employer manager
        -Date hireDate
        -String position
        +getSalary()
        +setSalary()
        +getManager()
        +setManager()
    }

    class Employer {
        -String department
        -String title
        -List~Employee~ managedEmployees
        +getDepartment()
        +setDepartment()
        +addManagedEmployee()
        +removeManagedEmployee()
        +getTitle()
        +setTitle()
    }

    class Company {
        -Long id
        -String name
        -String address
        -List~BusinessPerson~ employees
        +addEmployee()
        +removeEmployee()
        +getEmployees()
    }

    class Training {
        -Long id
        -String trainingName
        -Date completionDate
        -Date expiryDate
        -BusinessPerson person
        +isExpired()
        +getRemainingDays()
    }

    class Paycheck {
        -Long id
        -Employee employee
        -double grossPay
        -Double bonus
        -double taxDeduction
        -double insuranceDeduction
        -double netPay
        -LocalDate payDate
        -String payPeriod
        -LocalDateTime createdAt
        +calculateNetPay()
        +getEmployee()
        +setEmployee()
        +getEmployeeId()
    }

%% Strategy Pattern
    class TaxCalculationStrategy {
        <<interface>>
        +calculateTax(grossPay)
    }

    class FlatTaxStrategy {
        -double taxRate
        +calculateTax(grossPay)
    }

    class ProgressiveTaxStrategy {
        -Map~Double,Double~ taxBrackets
        +calculateTax(grossPay)
    }

%% Factory Pattern
    class BusinessPersonFactory {
        +createEmployee(name, email, salary)
        +createEmployer(name, email, department)
    }

    class DTOFactory {
        +createDTO(employee)
        +createDTO(employer)
        +createDTO(training)
    }

%% DTOs
    class EmployerDTO {
        -String department
        -String title
        -Integer directReportsCount
        +getPersonType()
        +getDepartment()
        +getTitle()
        +getDIrectReportsCount()
        +builder()
    }

    class EmployeeDTO {
        -Double salary
        -String position
        -LocalDate hireDate
        -Long managerId
        -String managerName
        +getPersonType()
        +getSalary()
        +getPosition()
        +getHireDate()
        +getManagerId()
        +getManagerName()
        +builder()
    }

    class TrainingDTO {
        -Long id
        -String trainingName
        -String description
        -LocalDate completionDate
        -LocalDate expiryDate
        -boolean required
        -boolean expired
        -Long personId
        -String personName
        -LocalDateTime createdAt
        +getId()
        +getTrainingName()
        +getDescription()
        +getCompletionDate()
        +getExpiryDate()
        +isRequired()
        +isExpired()
        +getPersonId()
        +getCreatedAt()
        +builder()
    }

    class ErrorResponse {
        <<record>>
        -LocalDateTime timeStamp
        -int status
        -String error
        -String message
    }

    class PaycheckDTO {
        <<record>>
        -Long id
        -Long employeeId
        -String employeeName
        -Double grossPay
        -Double bonus
        -Double taxDeduction
        -Double insuranceDeduction
        -Double totalDeductions
        -Double netPay
        -LocalDate payDate
        -String taxStrategyUsed
    }

    class PayrollSummaryDTO {
        <<record>>
        -Long businessId
        -String businessName
        -LocalDate startDate
        -LocalDate endDate
        -Integer totalPaychecks
        -Integer totalEmployees
        -Double totalGrossPay
        -Double totalBonus
        -Double totalTaxDeductions
        -Double totalInsuranceDeductions
        -Double totalDeductions
        -Double totalNetPay
        -Double averageGrossPay
        -Double averageNetPay
        -Double averageTaxRate
        -Double averageInsuranceRate
    }

    class DistributeBonusRequest {
        <<record>>
        -Long businessId
        -Double bonusAmount
        -List~Long~ employeeIds
        -String department
        -String description
    }

    class BonusDistributionResponse {
        <<record>>
        -Long businessId
        -String businessName
        -Integer totalEmployeesProcessed
        -Integer successfulPaychecks
        -Integer failedPaychecks
        -Double totalGrossPaid
        -Double totalNetPaid
        -Double totalTaxDeducted
        -Double totalInsuranceDeducted
        -List~PaycheckDTO~ paychecks
        -List~String~ errors
        +success(businessId, businessName, paychecks) BonusDistributionResponse
    }

%% Services
    class PayrollService {
        <<service>>
        -EmployeeService employeeService
        -PaycheckRepository paycheckRepository
        -BusinessRepository businessRepository
        -TaxCalculationStrategy taxStrategy
        -double insuranceRate
        +calculatePayroll(employeeId) PaycheckDTO
        +calculatePayrollWithAdditionalPay(employeeId, additionalPay) PaycheckDTO
        +distributeBonuses(request) List~PaycheckDTO~
        +setTaxStrategy(strategy)
        +getCurrentTaxStrategyName() String
        +getPayrollHistory(employeeId) List~PaycheckDTO~
        +getPayrollHistory(employeeId, startDate, endDate) List~PaycheckDTO~
        +getPayrollSummary(businessId, startDate, endDate) PayrollSummaryDTO
        +updatePaycheck(paycheckId, grossPay, bonus, taxDeduction, insuranceDeduction) PaycheckDTO
    }

    class EmployeeService {
        <<service>>
        +createEmployee(CreateEmployeeRequest)
        +getEmployee(Long)
        +getAllEmployees()
        +updateEmployee(Long, UpdateEmployeeRequest)
        +deleteEmployee(Long)
        +getEmployeesByBusiness(Long)
        +getEmployeesByManager(Long)
        +assignManager(Long, Long)
        +removeManager(Long)
        +updateSalary(Long, Double)
        +giveBonus(Long, Double)
        +updatePosition(Long, String)
        +updateStatus(Long, String)
        +searchByName(String)
        +getEmployeesByPosition(String)
        +getEmployeesHiredAfter(String)
    }

    class EmployerService {
        <<service>>
        +createEmployer(CreateEmployerRequest)
        +getEmployer(Long)
        +getAllEmployers()
        +updateEmployer(Long, UpdateEmployerRequest)
        +deleteEmployer(Long)
        +getEmployersByBusiness(Long)
        +getEmployersByDepartment(String)
        +addManagedEmployee(Long, Long)
        +removeManagedEmployee(Long, Long)
        +getDirectReports(Long)
        +getDirectReportsCount(Long)
        +updateDepartment(Long, String)
        +updateTitle(Long, String)
        +updateStatus(Long, String)
        +searchByName(String)
        +getEmployersByTitle(String)
    }

    class TrainingService {
        <<service>>
        +addTraining(training)
        +checkExpiredTrainings(person)
        +getTrainingsByPerson(personId)
    }

    class BusinessService {
        <<service>>
        +createBusiness(businessDTO)
        +updateBusiness(id, businessDTO)
        +deleteBusiness(id)
        +getBusiness(id)
    }

%% Controllers
    class EmployeeController {
        <<RestController>>
        -EmployeeService employeeService
        +createEmployee(CreateEmployeeRequest)
        +getEmployee(Long)
        +getAllEmployees()
        +updateEmployee(Long, UpdateEmployeeRequest)
        +deleteEmployee(Long)
        +getEmployeesByBusiness(Long)
        +getEmployeesByManager(Long)
        +assignManager(Long, Long)
        +updateSalary(Long, Double)
        +giveBonus(Long, Double)
    }

    class EmployerController {
        <<RestController>>
        -EmployerService employerService
        +createEmployer(CreateEmployerRequest)
        +getEmployer(Long)
        +getAllEmployers()
        +updateEmployer(Long, UpdateEmployerRequest)
        +deleteEmployer(Long)
        +getEmployersByBusiness(Long)
        +getEmployersByDepartment(String)
        +getDirectReports(Long)
    }

    class PayrollController {
        <<RestController>>
        -PayrollService payrollService
        -BusinessService businessService
        +calculatePayroll(employeeId, additionalPay) ResponseEntity~PaycheckDTO~ "POST /api/payroll/calculate/{employeeId}"
        +distributeBonuses(request) ResponseEntity~BonusDistributionResponse~ "POST /api/payroll/bonuses"
        +getCurrentTaxStrategy() ResponseEntity~String~ "GET /api/payroll/tax-strategy"
        +getPayrollHistory(employeeId) ResponseEntity~List~PaycheckDTO~~ "GET /api/payroll/history/{employeeId}"
        +getPayrollHistoryByDateRange(employeeId, startDate, endDate) ResponseEntity~List~PaycheckDTO~~ "GET /api/payroll/history/{employeeId}/range"
        +getPayrollSummary(businessId, startDate, endDate) ResponseEntity~PayrollSummaryDTO~ "GET /api/payroll/summary/{businessId}"
        +updatePaycheck(paycheckId, grossPay, bonus, taxDeduction, insuranceDeduction) ResponseEntity~PaycheckDTO~ "PUT /api/payroll/paycheck/{paycheckId}"
    }

    class TrainingController {
        <<RestController>>
        -TrainingService trainingService
        +addTraining(trainingDTO)
        +getTrainingsByPerson(personId)
        +checkExpiredTrainings(personId)
    }

    class BusinessController {
        <<RestController>>
        -BusinessService businessService
        +createBusiness(businessDTO)
        +updateBusiness(id, businessDTO)
        +deleteBusiness(id)
        +getBusiness(id)
    }

%% Repositories
    class EmployeeRepository {
        <<Repository>>
        +save(employee)
        +findById(id)
        +findAll()
        +delete(employee)
        +findByBusinessId(Long)
        +findByManagerId(Long)
        +findByEmail(String)
        +findByPosition(String)
        +findByStatus(String)
        +findByNameContainingIgnoreCase(String)
        +findBySalaryBetween(Double, Double)
        +findByHireDateAfter(LocalDate)
    }

    class EmployerRepository {
        <<Repository>>
        +save(employer)
        +findById(id)
        +findAll()
        +delete(employer)
        +findByBusinessId(Long)
        +findByDepartment(String)
        +findByEmail(String)
        +findByTitle(String)
        +findByStatus(String)
        +findByNameContainingIgnoreCase(String)
    }

    class BusinessRepository {
        <<Repository>>
        +save(business)
        +findById(id)
        +findAll()
        +delete(business)
    }

    class TrainingRepository {
        <<Repository>>
        +save(training)
        +findByPersonId(personId)
        +findExpiredTrainings()
    }

    class PaycheckRepository {
        <<Repository>>
        +save(paycheck)
        +findById(id)
        +findByEmployeeId(employeeId)
        +findByPayDateBetween(startDate, endDate)
        +findByEmployeeIdAndDateRange(employeeId, startDate, endDate)
        +findByBusinessIdAndDateRange(businessId, startDate, endDate)
    }

%% Exceptions
    class GlobalExceptionHandler {
        <<RestControllerAdvice>>
        +handleEmployerNotFoundException(EmployerNotFoundException)
        +handleEmployeeNotFoundException(EmployeeNotFoundException)
        +handleBusinessNotFoundException(BusinessNotFoundException)
        +handleInvalidBusinessException(InvalidBusinessException)
        +handleIllegalArgumentException(IllegalArgumentException)
        +handleException(Exception)
    }

    class EmployerNotFoundException {
        <<Exception>>
        +EmployerNotFoundException(employerId)
        +EmployerNotFoundException(message)
    }

    class EmployeeNotFoundException {
        <<Exception>>
        +EmployeeNotFoundException(employeeId)
        +EmployeeNotFoundException(message)
    }

    class BusinessNotFoundException {
        <<Exception>>
        +BusinessNotFoundException(id)
        +BusinessNotFoundException(message)
    }

    class InvalidBusinessException {
        <<Exception>>
        +InvalidBusinessException(message)
        +InvalidBusinessException(message, cause)
    }

    class ResourceNotFoundException {
        <<Exception>>
        +ResourceNotFoundException(resource, field, value)
    }

    class PayrollCalculationException {
        <<Exception>>
        +PayrollCalculationException(message, employeeId)
        +PayrollCalculationException(message, employeeId, cause)
    }

    class BusinessValidationException {
        <<Exception>>
        +BusinessValidationException(message)
    }

%% Relationships - Inheritance
    BusinessPerson <|-- Employee
    BusinessPerson <|-- Employer
    BusinessPersonDTO <|-- EmployeeDTO
    BusinessPersonDTO <|-- EmployerDTO
    Business <|.. Company
    TaxCalculationStrategy <|.. FlatTaxStrategy
    TaxCalculationStrategy <|.. ProgressiveTaxStrategy
    RuntimeException <|.. EmployerNotFoundException
    RuntimeException <|.. EmployeeNotFoundException
    RuntimeException <|.. BusinessNotFoundException
    RuntimeException <|.. InvalidBusinessException
    RuntimeException <|.. ResourceNotFoundException
    RuntimeException <|.. PayrollCalculationException
    RuntimeException <|.. BusinessValidationException

%% Relationships - Associations
    Employee --> Employer : managed by
    Company "1" --> "*" BusinessPerson : employs
    Training "*" --> "1" BusinessPerson : completed by
    Paycheck "*" --> "1" Employee : paid to
    GlobalExceptionHandler --> EmployerNotFoundException : handled by
    GlobalExceptionHandler --> EmployeeNotFoundException : handled by
    GlobalExceptionHandler --> BusinessNotFoundException : handled by
    GlobalExceptionHandler --> InvalidBusinessException : handled by
    GlobalExceptionHandler --> ResourceNotFoundException : handled by
    GlobalExceptionHandler --> PayrollCalculationException : handled by
    GlobalExceptionHandler --> BusinessValidationException : handled by

%% Services use Repositories
    EmployeeService --> EmployeeRepository
    EmployeeService --> EmployerRepository
    EmployeeService --> BusinessRepository
    EmployerService --> EmployerRepository
    EmployerService --> EmployeeRepository
    EmployerService --> BusinessRepository
    BusinessService --> BusinessRepository
    TrainingService --> TrainingRepository
    PayrollService --> PaycheckRepository
    PayrollService --> BusinessRepository

%% Services use Strategies
    PayrollService --> TaxCalculationStrategy

%% Services use other Services
    PayrollService --> EmployeeService

%% Controllers use Services
    EmployeeController --> EmployeeService
    EmployerController --> EmployerService
    PayrollController --> PayrollService
    PayrollController --> BusinessService
    TrainingController --> TrainingService
    BusinessController --> BusinessService

%% Services return DTOs
    PayrollService ..> PaycheckDTO : returns
    PayrollService ..> PayrollSummaryDTO : returns
    PayrollController ..> PaycheckDTO : returns
    PayrollController ..> PayrollSummaryDTO : returns
    PayrollController ..> BonusDistributionResponse : returns

%% Factory creates BusinessPersons
    BusinessPersonFactory ..> Employee : creates
    BusinessPersonFactory ..> Employer : creates
    DTOFactory ..> EmployeeDTO : creates
    DTOFactory ..> EmployerDTO : creates